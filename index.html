<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA - Premium AI Assistant</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Premium Color Palette */
            --bg-dark: #0d0d12;
            --bg-card: rgba(18, 18, 28, 0.85);
            --bg-card-hover: rgba(25, 25, 40, 0.9);

            /* Gold & Rose Gold Accents */
            --gold: #d4af37;
            --gold-light: #f4d47c;
            --rose-gold: #b76e79;
            --rose-gold-light: #e8a5b0;

            /* Purple Tones */
            --purple-deep: #4a1d6e;
            --purple: #7b2cbf;
            --purple-light: #9d4edd;
            --lavender: #c77dff;

            /* Accent Colors */
            --cyan: #00d4ff;
            --emerald: #10b981;
            --amber: #f59e0b;
            --coral: #ff6b6b;

            /* Text */
            --text: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-dim: rgba(255, 255, 255, 0.4);

            /* Gradients */
            --gradient-premium: linear-gradient(135deg, var(--gold) 0%, var(--rose-gold) 50%, var(--purple) 100%);
            --gradient-orb: radial-gradient(circle at 30% 30%, rgba(212, 175, 55, 0.5), rgba(183, 110, 121, 0.4) 40%, rgba(123, 44, 191, 0.3) 70%, rgba(13, 13, 18, 0.95));
            --gradient-glow: radial-gradient(circle, rgba(212, 175, 55, 0.15), transparent 70%);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(123, 44, 191, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(212, 175, 55, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(183, 110, 121, 0.05) 0%, transparent 60%);
            pointer-events: none;
            animation: bgShift 20s ease-in-out infinite alternate;
        }

        @keyframes bgShift {
            0% {
                opacity: 0.8;
            }

            100% {
                opacity: 1;
            }
        }

        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr 300px;
            grid-template-rows: auto 1fr;
            min-height: 100vh;
            gap: 16px;
            padding: 16px;
            position: relative;
            z-index: 1;
        }

        /* Premium Header */
        .header {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid rgba(212, 175, 55, 0.15);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 28px;
            font-weight: 700;
            background: var(--gradient-premium);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 4px;
            text-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
        }

        .header-time {
            font-family: 'Orbitron', sans-serif;
            font-size: 20px;
            background: linear-gradient(90deg, var(--gold), var(--rose-gold));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-date {
            font-size: 12px;
            color: var(--text-dim);
            margin-left: 16px;
            letter-spacing: 1px;
        }

        /* Premium Widget Styles */
        .widget {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid rgba(212, 175, 55, 0.1);
            padding: 18px;
            backdrop-filter: blur(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
        }

        .widget:hover {
            border-color: rgba(212, 175, 55, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(212, 175, 55, 0.1);
        }

        .widget-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 10px;
            letter-spacing: 3px;
            background: linear-gradient(90deg, var(--gold), var(--rose-gold));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .widget-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 0 4px rgba(212, 175, 55, 0.5));
        }

        /* Left Panel */
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 12px;
            overflow-y: auto;
            max-height: calc(100vh - 100px);
        }

        /* Battery Widget */
        .battery-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .battery-icon {
            width: 60px;
            height: 28px;
            border: 2px solid var(--gold);
            border-radius: 6px;
            position: relative;
            display: flex;
            align-items: center;
            padding: 3px;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.2);
        }

        .battery-icon::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 12px;
            background: var(--gold);
            border-radius: 0 2px 2px 0;
        }

        .battery-level {
            height: 100%;
            background: linear-gradient(90deg, var(--emerald), var(--gold));
            border-radius: 3px;
            transition: width 0.5s ease;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
        }

        .battery-info {
            flex: 1;
        }

        .battery-percent {
            font-size: 26px;
            font-weight: 600;
            background: linear-gradient(90deg, var(--gold), var(--rose-gold));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .battery-status {
            font-size: 11px;
            color: var(--text-dim);
        }

        /* CPU Widget */
        .cpu-meter {
            height: 8px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }

        .cpu-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--purple), var(--lavender), var(--rose-gold));
            border-radius: 4px;
            transition: width 0.3s ease;
            box-shadow: 0 0 8px rgba(157, 78, 221, 0.4);
        }

        .cpu-value {
            font-size: 28px;
            font-weight: 600;
            background: linear-gradient(90deg, var(--purple-light), var(--lavender));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .cpu-cores {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-top: 12px;
        }

        .core {
            text-align: center;
        }

        .core-bar {
            height: 40px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 6px;
            position: relative;
            overflow: hidden;
        }

        .core-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, var(--purple), var(--lavender));
            transition: height 0.3s ease;
            box-shadow: 0 -4px 12px rgba(157, 78, 221, 0.3);
        }

        .core-label {
            font-size: 9px;
            color: var(--text-dim);
            margin-top: 4px;
        }

        /* Memory Widget */
        .memory-ring {
            width: 90px;
            height: 90px;
            position: relative;
            margin: 0 auto;
        }

        .memory-ring svg {
            transform: rotate(-90deg);
        }

        .memory-ring-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.08);
            stroke-width: 8;
        }

        .memory-ring-fill {
            fill: none;
            stroke: url(#memGradient);
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
            filter: drop-shadow(0 0 6px rgba(212, 175, 55, 0.4));
        }

        .memory-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .memory-percent {
            font-size: 18px;
            font-weight: 600;
            background: linear-gradient(90deg, var(--gold), var(--rose-gold));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .memory-label {
            font-size: 9px;
            color: var(--text-dim);
        }

        .memory-details {
            display: flex;
            justify-content: space-around;
            margin-top: 12px;
            font-size: 11px;
        }

        .mem-stat {
            text-align: center;
        }

        .mem-stat-value {
            font-weight: 600;
            color: var(--gold);
        }

        /* Network Widget */
        .network-status {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .network-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(212, 175, 55, 0.1));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .network-icon.offline {
            background: rgba(255, 107, 107, 0.1);
            border-color: rgba(255, 107, 107, 0.3);
        }

        .network-type {
            font-size: 14px;
            font-weight: 500;
            color: var(--emerald);
        }

        .network-speed {
            font-size: 11px;
            color: var(--text-dim);
        }

        .network-bars {
            display: flex;
            gap: 4px;
            margin-top: 12px;
        }

        .net-bar {
            flex: 1;
            height: 30px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .net-bar-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            transition: height 0.3s ease;
        }

        .net-bar-fill.download {
            background: linear-gradient(to top, var(--emerald), var(--cyan));
        }

        .net-bar-fill.upload {
            background: linear-gradient(to top, var(--purple), var(--lavender));
        }

        /* ===================== */
        /* CENTER PANEL - ORB    */
        /* ===================== */
        .center-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .orb-wrapper {
            position: relative;
            width: 260px;
            height: 260px;
        }

        .orb {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: var(--gradient-orb);
            box-shadow:
                0 0 80px rgba(212, 175, 55, 0.3),
                0 0 120px rgba(183, 110, 121, 0.2),
                inset 0 0 60px rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: orbFloat 6s ease-in-out infinite;
        }

        .orb:hover {
            box-shadow:
                0 0 100px rgba(212, 175, 55, 0.4),
                0 0 150px rgba(183, 110, 121, 0.3),
                inset 0 0 80px rgba(255, 255, 255, 0.08);
            transform: scale(1.02);
        }

        .orb.listening {
            animation: orbPulse 1.5s ease-in-out infinite;
            box-shadow:
                0 0 100px rgba(16, 185, 129, 0.5),
                0 0 150px rgba(0, 212, 255, 0.3),
                inset 0 0 60px rgba(255, 255, 255, 0.1);
        }

        @keyframes orbFloat {

            0%,
            100% {
                transform: translateY(0) scale(1);
            }

            50% {
                transform: translateY(-8px) scale(1.02);
            }
        }

        @keyframes orbPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.08);
            }
        }

        /* Premium Orbital System */
        .orb-container {
            position: absolute;
            inset: -60px;
            pointer-events: none;
        }

        /* Outer Glow Aura */
        .orb-aura {
            position: absolute;
            inset: 20px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(212, 175, 55, 0.08) 0%, transparent 70%);
            animation: auraBreath 4s ease-in-out infinite;
        }

        @keyframes auraBreath {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.6;
            }

            50% {
                transform: scale(1.1);
                opacity: 1;
            }
        }

        /* Elliptical Orbits */
        .orbit {
            position: absolute;
            border-radius: 50%;
            border: 1px solid transparent;
        }

        .orbit-1 {
            inset: 0;
            border-color: rgba(212, 175, 55, 0.25);
            animation: orbitSpin 20s linear infinite;
        }

        .orbit-2 {
            inset: 15px;
            border-color: rgba(183, 110, 121, 0.2);
            animation: orbitSpin 15s linear infinite reverse;
        }

        .orbit-3 {
            inset: 30px;
            border-color: rgba(123, 44, 191, 0.15);
            animation: orbitSpin 25s linear infinite;
        }

        @keyframes orbitSpin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Floating Particles on Orbits */
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            filter: blur(1px);
        }

        .orbit-1 .particle {
            background: radial-gradient(circle, var(--gold) 0%, transparent 70%);
            box-shadow: 0 0 12px var(--gold), 0 0 24px rgba(212, 175, 55, 0.5);
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
        }

        .orbit-2 .particle {
            background: radial-gradient(circle, var(--rose-gold) 0%, transparent 70%);
            box-shadow: 0 0 12px var(--rose-gold), 0 0 24px rgba(183, 110, 121, 0.5);
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
        }

        .orbit-3 .particle {
            background: radial-gradient(circle, var(--lavender) 0%, transparent 70%);
            box-shadow: 0 0 12px var(--lavender), 0 0 24px rgba(199, 125, 255, 0.5);
            top: 50%;
            right: -4px;
            transform: translateY(-50%);
        }

        /* Arc Segments */
        .arc {
            position: absolute;
            border-radius: 50%;
            border: 2px solid transparent;
        }

        .arc-1 {
            inset: 5px;
            border-top-color: var(--gold);
            border-right-color: var(--gold);
            opacity: 0.4;
            animation: arcRotate 8s linear infinite;
            filter: drop-shadow(0 0 6px var(--gold));
        }

        .arc-2 {
            inset: 20px;
            border-bottom-color: var(--rose-gold);
            border-left-color: var(--rose-gold);
            opacity: 0.3;
            animation: arcRotate 12s linear infinite reverse;
            filter: drop-shadow(0 0 6px var(--rose-gold));
        }

        .arc-3 {
            inset: 35px;
            border-top-color: var(--purple-light);
            opacity: 0.25;
            animation: arcRotate 10s linear infinite;
            filter: drop-shadow(0 0 4px var(--purple-light));
        }

        @keyframes arcRotate {
            to {
                transform: rotate(360deg);
            }
        }

        /* Sparkle Points */
        .sparkles {
            position: absolute;
            inset: 0;
        }

        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--gold);
            border-radius: 50%;
            animation: twinkle 2s ease-in-out infinite;
        }

        .sparkle:nth-child(1) {
            top: 10%;
            left: 20%;
            animation-delay: 0s;
        }

        .sparkle:nth-child(2) {
            top: 25%;
            right: 15%;
            animation-delay: 0.5s;
        }

        .sparkle:nth-child(3) {
            bottom: 20%;
            left: 10%;
            animation-delay: 1s;
        }

        .sparkle:nth-child(4) {
            bottom: 15%;
            right: 25%;
            animation-delay: 1.5s;
        }

        .sparkle:nth-child(5) {
            top: 50%;
            left: 5%;
            animation-delay: 0.3s;
        }

        .sparkle:nth-child(6) {
            top: 40%;
            right: 8%;
            animation-delay: 0.8s;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.2;
                transform: scale(0.8);
            }

            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        .status-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            letter-spacing: 6px;
            background: var(--gradient-premium);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-top: 28px;
            text-transform: uppercase;
        }

        .query-display {
            margin-top: 8px;
            font-size: 13px;
            color: var(--text-dim);
            text-align: center;
            max-width: 300px;
        }

        /* AI Response Display Under Orb */
        .ai-response-container {
            margin-top: 24px;
            width: 100%;
            max-width: 500px;
            min-height: 60px;
            padding: 20px 28px;
            background: linear-gradient(135deg, rgba(18, 18, 28, 0.9), rgba(25, 25, 40, 0.8));
            border-radius: 20px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            backdrop-filter: blur(20px);
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 0 40px rgba(212, 175, 55, 0.05);
        }

        .ai-response-container.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .ai-response-container::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 20%;
            right: 20%;
            height: 2px;
            background: var(--gradient-premium);
            border-radius: 2px;
        }

        .ai-response-label {
            font-family: 'Orbitron', sans-serif;
            font-size: 9px;
            letter-spacing: 3px;
            color: var(--gold);
            text-transform: uppercase;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .ai-response-label::before {
            content: '‚óÜ';
            font-size: 6px;
            animation: sparkle 2s ease-in-out infinite;
        }

        @keyframes sparkle {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        .ai-response-text {
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-secondary);
            font-weight: 400;
        }

        /* Right Panel */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 12px;
            overflow-y: auto;
            max-height: calc(100vh - 100px);
        }

        /* Weather Widget */
        .weather-main {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .weather-icon {
            font-size: 48px;
            filter: drop-shadow(0 0 8px rgba(212, 175, 55, 0.3));
        }

        .weather-temp {
            font-size: 36px;
            font-weight: 600;
            background: linear-gradient(90deg, var(--gold), var(--rose-gold));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .weather-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .weather-location {
            font-size: 11px;
            color: var(--gold);
            margin-top: 4px;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid rgba(212, 175, 55, 0.15);
        }

        .weather-detail {
            text-align: center;
        }

        .weather-detail-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--text);
        }

        .weather-detail-label {
            font-size: 10px;
            color: var(--text-dim);
        }

        /* Storage Widget */
        .storage-drives {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .drive {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .drive-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(183, 110, 121, 0.1));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: var(--gold);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .drive-info {
            flex: 1;
        }

        .drive-name {
            font-size: 13px;
            font-weight: 500;
        }

        .drive-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 3px;
            margin-top: 4px;
            overflow: hidden;
        }

        .drive-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--rose-gold), var(--purple));
            border-radius: 3px;
        }

        .drive-space {
            font-size: 11px;
            color: var(--text-dim);
        }

        /* Uptime Widget */
        .uptime-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 28px;
            text-align: center;
            background: linear-gradient(90deg, var(--gold), var(--rose-gold));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 8px 0;
        }

        .uptime-label {
            text-align: center;
            font-size: 11px;
            color: var(--text-dim);
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .action-btn {
            padding: 14px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
            border: 1px solid rgba(212, 175, 55, 0.15);
            border-radius: 14px;
            color: var(--text);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .action-btn:hover {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(183, 110, 121, 0.05));
            border-color: var(--gold);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.15);
        }

        .action-icon {
            font-size: 22px;
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 180px;
        }

        .chat-msg {
            padding: 10px 14px;
            border-radius: 14px;
            font-size: 13px;
            max-width: 90%;
            animation: msgIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes msgIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-msg.user {
            align-self: flex-end;
            background: var(--gradient-premium);
            color: #000;
            font-weight: 500;
        }

        .chat-msg.ai {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(212, 175, 55, 0.1);
        }

        .chat-input-row {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.15);
            border-radius: 25px;
            color: #fff;
            font-size: 13px;
            outline: none;
            transition: all 0.3s;
        }

        .chat-input:focus {
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.1);
        }

        .chat-send {
            width: 44px;
            height: 44px;
            background: var(--gradient-premium);
            border: none;
            border-radius: 50%;
            color: #000;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .chat-send:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
        }

        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--gold), var(--rose-gold));
            border-radius: 2px;
        }

        /* Orb Animations */
        .orb-icon {
            font-size: 100px;
            color: #fff;
            display: none;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            pointer-events: none;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }

        .orb.animating {
            background: transparent !important;
            box-shadow: none !important;
            animation: none !important;
        }

        .orb.animating::before {
            display: none;
        }

        /* Dice Animation */
        @keyframes rollDice {
            0% {
                transform: rotate(0deg) scale(0.1);
                opacity: 0;
            }

            20% {
                opacity: 1;
            }

            50% {
                transform: rotate(720deg) scale(1.2);
            }

            100% {
                transform: rotate(1080deg) scale(1);
            }
        }

        /* App Pop Animation */
        @keyframes appPop {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            60% {
                transform: scale(1.2);
                opacity: 1;
            }

            80% {
                transform: scale(0.9);
            }

            100% {
                transform: scale(1);
            }
        }

        .animate-dice {
            display: flex !important;
            animation: rollDice 2s cubic-bezier(0.25, 1, 0.5, 1) forwards;
            color: var(--gold);
        }

        .animate-logo {
            display: flex !important;
            animation: appPop 1.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* Brand Colors */
        .fa-youtube {
            color: #FF0000;
        }

        .fa-google {
            color: #4285F4;
        }

        .fa-spotify {
            color: #1DB954;
        }

        .fa-whatsapp {
            color: #25D366;
        }

        .fa-instagram {
            background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: #d6249f;
        }

        .fa-twitter {
            color: #1DA1F2;
        }

        .fa-github {
            color: #fff;
        }

        .fa-linkedin {
            color: #0077b5;
        }

        .fa-wikipedia-w {
            color: #fff;
        }

        .fa-dice {
            color: var(--gold);
            filter: drop-shadow(0 0 10px var(--gold));
        }

        /* More Brand Colors */
        .fa-calculator {
            color: var(--cyan);
        }

        .fa-clock {
            color: var(--amber);
        }

        .fa-coins {
            color: var(--gold);
        }

        .fa-map {
            color: #34A853;
        }

        .fa-newspaper {
            color: #fff;
        }

        .fa-envelope {
            color: #EA4335;
        }

        .fa-film {
            color: #E50914;
        }

        /* Netflix */

        /* More Brand Colors */
        .fa-calculator {
            color: var(--cyan);
        }

        .fa-clock {
            color: var(--amber);
        }

        .fa-coins {
            color: var(--gold);
        }

        .fa-map {
            color: #34A853;
        }

        .fa-newspaper {
            color: #fff;
        }

        .fa-envelope {
            color: #EA4335;
        }

        .fa-film {
            color: #E50914;
        }

        /* Netflix */

        /* More Brand Colors */
        .fa-calculator {
            color: var(--cyan);
        }

        .fa-clock {
            color: var(--amber);
        }

        .fa-coins {
            color: var(--gold);
        }

        .fa-map {
            color: #34A853;
        }

        .fa-newspaper {
            color: #fff;
        }

        .fa-envelope {
            color: #EA4335;
        }

        .fa-film {
            color: #E50914;
        }

        /* Netflix */

        .orb.visualizing {
            animation: none !important;
            transition: transform 0.05s ease-out, box-shadow 0.05s ease-out !important;
        }

        /* Notes Widget */
        .notes-list {
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .note-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 8px;
            margin-bottom: 5px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 2px solid var(--gold);
        }

        .empty-notes {
            color: var(--text-dim);
            font-style: italic;
            text-align: center;
            padding: 10px;
        }

        .delete-note {
            cursor: pointer;
            color: var(--coral);
            margin-left: 8px;
            opacity: 0.7;
        }

        .delete-note:hover {
            opacity: 1;
        }

        /* Theme Overrides */
        body.theme-cyberpunk {
            --gold: #fcee0a;
            --rose-gold: #00f0ff;
            --purple: #ff003c;
            --bg-dark: #050510;
        }

        body.theme-ocean {
            --gold: #00d2ff;
            --rose-gold: #3a7bd5;
            --purple: #0066cc;
            --bg-dark: #001e36;
        }

        body.theme-matrix {
            --gold: #00ff00;
            --rose-gold: #003300;
            --purple: #00cc00;
            --bg-dark: #000;
            font-family: 'Courier New', monospace;
        }

        body.theme-crimson {
            --gold: #ff0000;
            --rose-gold: #990000;
            --purple: #cc0000;
            --bg-dark: #1a0000;
        }

        body.theme-midnight {
            --gold: #7c4dff;
            --rose-gold: #b388ff;
            --purple: #651fff;
            --bg-dark: #0a001a;
        }
    </style>
</head>

<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="logo">AURA</div>
            <div style="display:flex;align-items:center;">
                <span class="header-time" id="liveTime">00:00:00</span>
                <span class="header-date" id="liveDate">Loading...</span>
            </div>
        </header>

        <!-- Left Panel - System Widgets -->
        <aside class="left-panel">
            <!-- Battery -->
            <div class="widget">
                <div class="widget-title"><span class="widget-icon">üîã</span> Battery</div>
                <div class="battery-container">
                    <div class="battery-icon">
                        <div class="battery-level" id="batteryLevel" style="width:100%"></div>
                    </div>
                    <div class="battery-info">
                        <div class="battery-percent"><span id="batteryPercent">100</span>%</div>
                        <div class="battery-status" id="batteryStatus">Checking...</div>
                    </div>
                </div>
            </div>

            <!-- CPU -->
            <div class="widget">
                <div class="widget-title"><span class="widget-icon">‚ö°</span> CPU Usage</div>
                <div class="cpu-value"><span id="cpuPercent">0</span>%</div>
                <div class="cpu-meter">
                    <div class="cpu-bar" id="cpuBar" style="width:0%"></div>
                </div>
                <div class="cpu-cores" id="cpuCores"></div>
            </div>

            <!-- Memory -->
            <div class="widget">
                <div class="widget-title"><span class="widget-icon">üíæ</span> Memory</div>
                <div class="memory-ring">
                    <svg width="90" height="90" viewBox="0 0 90 90">
                        <defs>
                            <linearGradient id="memGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#d4af37" />
                                <stop offset="50%" style="stop-color:#b76e79" />
                                <stop offset="100%" style="stop-color:#7b2cbf" />
                            </linearGradient>
                        </defs>
                        <circle class="memory-ring-bg" cx="45" cy="45" r="36" />
                        <circle class="memory-ring-fill" id="memoryRing" cx="45" cy="45" r="36" stroke-dasharray="226"
                            stroke-dashoffset="226" />
                    </svg>
                    <div class="memory-text">
                        <div class="memory-percent" id="memPercent">0%</div>
                        <div class="memory-label">Used</div>
                    </div>
                </div>
                <div class="memory-details">
                    <div class="mem-stat">
                        <div class="mem-stat-value" id="memUsed">0 GB</div>
                        <div>Used</div>
                    </div>
                    <div class="mem-stat">
                        <div class="mem-stat-value" id="memTotal">0 GB</div>
                        <div>Total</div>
                    </div>
                </div>
            </div>

            <!-- Network -->
            <div class="widget">
                <div class="widget-title"><span class="widget-icon">üì∂</span> Network</div>
                <div class="network-status">
                    <div class="network-icon" id="networkIcon">üì∂</div>
                    <div>
                        <div class="network-type" id="networkType">Checking...</div>
                        <div class="network-speed" id="networkSpeed">-- Mbps</div>
                    </div>
                </div>
                <div class="network-bars">
                    <div class="net-bar">
                        <div class="net-bar-fill download" id="downloadBar" style="height:0%"></div>
                    </div>
                    <div class="net-bar">
                        <div class="net-bar-fill upload" id="uploadBar" style="height:0%"></div>
                    </div>
                </div>
                <div
                    style="display:flex;justify-content:space-around;margin-top:8px;font-size:10px;color:var(--text-dim);">
                    <span>‚Üì <span id="downloadSpeed">0</span> Mbps</span>
                    <span>‚Üë <span id="uploadSpeed">0</span> Mbps</span>
                </div>
            </div>

            <!-- Notes Widget -->
            <div class="widget">
                <div class="widget-title"><span class="widget-icon">üìù</span> Notes</div>
                <div id="notesList" class="notes-list">
                    <div class="empty-notes">No notes yet.</div>
                </div>
            </div>
        </aside>

        <!-- Center - Orb -->
        <main class="center-panel">
            <div class="orb-wrapper">
                <!-- Premium Orbital Container -->
                <div class="orb-container">
                    <!-- Outer Glow Aura -->
                    <div class="orb-aura"></div>

                    <!-- Rotating Orbits with Particles -->
                    <div class="orbit orbit-1">
                        <div class="particle"></div>
                    </div>
                    <div class="orbit orbit-2">
                        <div class="particle"></div>
                    </div>
                    <div class="orbit orbit-3">
                        <div class="particle"></div>
                    </div>

                    <!-- Glowing Arc Segments -->
                    <div class="arc arc-1"></div>
                    <div class="arc arc-2"></div>
                    <div class="arc arc-3"></div>

                    <!-- Twinkling Sparkles -->
                    <div class="sparkles">
                        <div class="sparkle"></div>
                        <div class="sparkle"></div>
                        <div class="sparkle"></div>
                        <div class="sparkle"></div>
                        <div class="sparkle"></div>
                        <div class="sparkle"></div>
                    </div>
                </div>
                <div class="orb" id="orb" onclick="toggleListening()">
                    <i id="orbIcon" class="fas fa-microphone orb-icon"></i>
                </div>
            </div>
            <div class="status-text" id="statusText">Ready</div>
            <p class="query-display" id="queryDisplay">Click orb or press Space to speak</p>

            <!-- AI Response Display -->
            <div class="ai-response-container" id="aiResponseContainer">
                <div class="ai-response-label">AURA Response</div>
                <div class="ai-response-text" id="aiResponseText"></div>
            </div>
        </main>

        <!-- Right Panel -->
        <aside class="right-panel">
            <!-- Weather -->
            <div class="widget">
                <div class="widget-title"><span class="widget-icon">üå§Ô∏è</span> Weather</div>
                <div class="weather-main">
                    <div class="weather-icon" id="weatherIcon">üå§Ô∏è</div>
                    <div>
                        <div class="weather-temp"><span id="weatherTemp">--</span>¬∞C</div>
                        <div class="weather-desc" id="weatherDesc">Loading...</div>
                        <div class="weather-location" id="weatherLocation">üìç --</div>
                    </div>
                </div>
                <div class="weather-details">
                    <div class="weather-detail">
                        <div class="weather-detail-value" id="weatherHumidity">--%</div>
                        <div class="weather-detail-label">Humidity</div>
                    </div>
                    <div class="weather-detail">
                        <div class="weather-detail-value" id="weatherWind">-- km/h</div>
                        <div class="weather-detail-label">Wind</div>
                    </div>
                    <div class="weather-detail">
                        <div class="weather-detail-value" id="weatherFeels">--¬∞</div>
                        <div class="weather-detail-label">Feels Like</div>
                    </div>
                </div>
            </div>

            <!-- Storage -->
            <div class="widget">
                <div class="widget-title"><span class="widget-icon">üíø</span> Storage</div>
                <div class="storage-drives" id="storageDrives">
                    <div class="drive">
                        <div class="drive-icon">C:</div>
                        <div class="drive-info">
                            <div class="drive-name">System Drive</div>
                            <div class="drive-bar">
                                <div class="drive-fill" style="width:65%"></div>
                            </div>
                        </div>
                        <div class="drive-space">65%</div>
                    </div>
                </div>
            </div>

            <!-- Uptime -->
            <div class="widget">
                <div class="widget-title"><span class="widget-icon">‚è±Ô∏è</span> Session Time</div>
                <div class="uptime-display" id="uptimeDisplay">00:00:00</div>
                <div class="uptime-label">Active Session Duration</div>
            </div>

            <!-- Quick Actions -->
            <div class="widget">
                <div class="widget-title"><span class="widget-icon">‚ö°</span> Quick Actions</div>
                <div class="quick-actions">
                    <button class="action-btn" onclick="openApp('youtube')"><span
                            class="action-icon">‚ñ∂Ô∏è</span>YouTube</button>
                    <button class="action-btn" onclick="openApp('google')"><span
                            class="action-icon">üîç</span>Search</button>
                    <button class="action-btn" onclick="openApp('gmail')"><span
                            class="action-icon">üìß</span>Gmail</button>
                    <button class="action-btn" onclick="openApp('maps')"><span
                            class="action-icon">üó∫Ô∏è</span>Maps</button>
                </div>
            </div>

            <!-- Chat -->
            <div class="widget chat-container">
                <div class="widget-title"><span class="widget-icon">üí¨</span> Assistant</div>
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input-row">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Type here..."
                        onkeypress="handleKey(event)">
                    <button class="chat-send" onclick="sendMessage()">‚Üë</button>
                </div>
            </div>
        </aside>
    </div>

    <script>
        // ========================================
        // STATE
        // ========================================
        let isListening = false;
        let recognition = null;
        let synthesis = window.speechSynthesis;
        let sessionStart = Date.now();
        let responseTimeout = null;

        const orb = document.getElementById('orb');
        const statusText = document.getElementById('statusText');
        const queryDisplay = document.getElementById('queryDisplay');
        const aiResponseContainer = document.getElementById('aiResponseContainer');
        const aiResponseText = document.getElementById('aiResponseText');

        // ========================================
        // INIT
        // ========================================
        function init() {
            updateTime();
            setInterval(updateTime, 1000);

            initBattery();
            initCPU();
            initMemory();
            initNetwork();
            initWeather();
            initUptime();
            initNotes();
            initSpeech();

            addChat('ai', 'Hello! I am AURA, your premium AI assistant. How may I help you today?');

            document.addEventListener('keydown', e => {
                if (e.code === 'Space' && e.target.tagName !== 'INPUT') {
                    e.preventDefault();
                    toggleListening();
                }
            });
        }

        // ========================================
        // TIME
        // ========================================
        function updateTime() {
            const now = new Date();
            document.getElementById('liveTime').textContent = now.toLocaleTimeString();
            document.getElementById('liveDate').textContent = now.toLocaleDateString('en-US', {
                weekday: 'long', month: 'short', day: 'numeric'
            });
        }

        // ========================================
        // BATTERY
        // ========================================
        async function initBattery() {
            if ('getBattery' in navigator) {
                const battery = await navigator.getBattery();
                updateBattery(battery);
                battery.addEventListener('levelchange', () => updateBattery(battery));
                battery.addEventListener('chargingchange', () => updateBattery(battery));
            } else {
                document.getElementById('batteryStatus').textContent = 'Not available';
            }
        }

        function updateBattery(battery) {
            const level = Math.round(battery.level * 100);
            document.getElementById('batteryPercent').textContent = level;
            document.getElementById('batteryLevel').style.width = level + '%';
            document.getElementById('batteryStatus').textContent = battery.charging ? '‚ö° Charging' : 'On Battery';

            const levelEl = document.getElementById('batteryLevel');
            if (level < 20) levelEl.style.background = 'var(--coral)';
            else if (level < 50) levelEl.style.background = 'var(--amber)';
            else levelEl.style.background = 'linear-gradient(90deg, var(--emerald), var(--gold))';
        }

        // ========================================
        // CPU (Simulated)
        // ========================================
        function initCPU() {
            const coresEl = document.getElementById('cpuCores');
            for (let i = 0; i < 4; i++) {
                coresEl.innerHTML += `
                    <div class="core">
                        <div class="core-bar"><div class="core-fill" id="core${i}" style="height:0%"></div></div>
                        <div class="core-label">Core ${i + 1}</div>
                    </div>
                `;
            }
            updateCPU();
            setInterval(updateCPU, 1000);
        }

        function updateCPU() {
            const total = 20 + Math.random() * 40;
            document.getElementById('cpuPercent').textContent = Math.round(total);
            document.getElementById('cpuBar').style.width = total + '%';

            for (let i = 0; i < 4; i++) {
                const coreUsage = 10 + Math.random() * 60;
                document.getElementById('core' + i).style.height = coreUsage + '%';
            }
        }

        // ========================================
        // MEMORY (Simulated)
        // ========================================
        function initMemory() {
            updateMemory();
            setInterval(updateMemory, 2000);
        }

        function updateMemory() {
            const used = 4 + Math.random() * 4;
            const total = 16;
            const percent = (used / total) * 100;

            document.getElementById('memPercent').textContent = Math.round(percent) + '%';
            document.getElementById('memUsed').textContent = used.toFixed(1) + ' GB';
            document.getElementById('memTotal').textContent = total + ' GB';

            const circumference = 226;
            const offset = circumference - (percent / 100) * circumference;
            document.getElementById('memoryRing').style.strokeDashoffset = offset;
        }

        // ========================================
        // NETWORK
        // ========================================
        function initNetwork() {
            updateNetwork();
            setInterval(updateNetwork, 3000);
        }

        function updateNetwork() {
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;

            if (connection) {
                const type = connection.effectiveType?.toUpperCase() || 'UNKNOWN';
                const downlink = connection.downlink || 0;

                document.getElementById('networkType').textContent = type;
                document.getElementById('networkSpeed').textContent = downlink.toFixed(2) + ' Mbps';
            } else {
                document.getElementById('networkType').textContent = navigator.onLine ? 'ONLINE' : 'OFFLINE';
                document.getElementById('networkSpeed').textContent = '-- Mbps';
            }

            const down = 20 + Math.random() * 60;
            const up = 10 + Math.random() * 40;
            document.getElementById('downloadBar').style.height = down + '%';
            document.getElementById('uploadBar').style.height = up + '%';
            document.getElementById('downloadSpeed').textContent = (down / 10).toFixed(1);
            document.getElementById('uploadSpeed').textContent = (up / 10).toFixed(1);
        }

        // ========================================
        // WEATHER
        // ========================================
        async function initWeather() {
            try {
                if ('geolocation' in navigator) {
                    navigator.geolocation.getCurrentPosition(async pos => {
                        const { latitude, longitude } = pos.coords;
                        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m`);
                        const data = await res.json();
                        updateWeather(data);
                    }, () => setDefaultWeather());
                } else {
                    setDefaultWeather();
                }
            } catch {
                setDefaultWeather();
            }
        }

        function updateWeather(data) {
            const current = data.current;
            document.getElementById('weatherTemp').textContent = Math.round(current.temperature_2m);
            document.getElementById('weatherHumidity').textContent = current.relative_humidity_2m + '%';
            document.getElementById('weatherWind').textContent = Math.round(current.wind_speed_10m) + ' km/h';
            document.getElementById('weatherFeels').textContent = Math.round(current.apparent_temperature) + '¬∞';

            const code = current.weather_code;
            const icons = { 0: '‚òÄÔ∏è', 1: 'üå§Ô∏è', 2: '‚õÖ', 3: '‚òÅÔ∏è', 45: 'üå´Ô∏è', 51: 'üåßÔ∏è', 61: 'üåßÔ∏è', 71: '‚ùÑÔ∏è', 95: '‚õàÔ∏è' };
            const desc = { 0: 'Clear', 1: 'Mostly Clear', 2: 'Partly Cloudy', 3: 'Cloudy', 45: 'Foggy', 51: 'Drizzle', 61: 'Rain', 71: 'Snow', 95: 'Thunderstorm' };

            document.getElementById('weatherIcon').textContent = icons[code] || 'üå§Ô∏è';
            document.getElementById('weatherDesc').textContent = desc[code] || 'Fair';
            document.getElementById('weatherLocation').textContent = 'üìç Current Location';
        }

        function setDefaultWeather() {
            document.getElementById('weatherTemp').textContent = '28';
            document.getElementById('weatherDesc').textContent = 'Partly Cloudy';
            document.getElementById('weatherLocation').textContent = 'üìç Location unavailable';
            document.getElementById('weatherHumidity').textContent = '65%';
            document.getElementById('weatherWind').textContent = '12 km/h';
            document.getElementById('weatherFeels').textContent = '30¬∞';
        }

        // ========================================
        // UPTIME
        // ========================================
        function initUptime() {
            updateUptime();
            setInterval(updateUptime, 1000);
        }

        function updateUptime() {
            const elapsed = Date.now() - sessionStart;
            const hours = Math.floor(elapsed / 3600000);
            const mins = Math.floor((elapsed % 3600000) / 60000);
            const secs = Math.floor((elapsed % 60000) / 1000);
            document.getElementById('uptimeDisplay').textContent =
                String(hours).padStart(2, '0') + ':' +
                String(mins).padStart(2, '0') + ':' +
                String(secs).padStart(2, '0');
        }

        // ========================================
        // ENHANCED SPEECH RECOGNITION SYSTEM
        // ========================================
        let wakeWordRecognition = null;
        let isWakeWordListening = false;
        let commandHistory = [];
        let lastConfidence = 0;
        let recognitionRetryCount = 0;
        const MAX_RETRY_COUNT = 5;
        const CONFIDENCE_THRESHOLD = 0.5;

        // Extended wake word variations for better detection
        const WAKE_PHRASES = [
            'hey aura', 'hey ara', 'hey ora', 'a aura', 'hey aurora', 'hi aura',
            'aura', 'hello aura', 'ok aura', 'okay aura', 'yo aura',
            'hey or', 'hey ura', 'hey our', 'heya aura', 'hay aura',
            'halo aura', 'halo ara', 'hola aura', 'hey euro', 'hey aora'
        ];

        // Audio context for sound effects
        let audioContext = null;

        function getAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        function initSpeech() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SR = window.SpeechRecognition || window.webkitSpeechRecognition;

                // Main command recognition with enhanced settings
                recognition = new SR();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = 'en-US';
                recognition.maxAlternatives = 5; // Get multiple alternatives for better matching

                recognition.onstart = () => {
                    recognitionRetryCount = 0;
                    orb.classList.add('listening');
                    statusText.textContent = 'Listening...';
                    updateConfidenceIndicator(0);
                    hideResponse();
                    playListeningSound();
                };

                recognition.onresult = (e) => {
                    let finalTranscript = '';
                    let interimTranscript = '';
                    let bestConfidence = 0;

                    for (let i = e.resultIndex; i < e.results.length; i++) {
                        const result = e.results[i];
                        const transcript = result[0].transcript;
                        const confidence = result[0].confidence || 0.8;

                        if (result.isFinal) {
                            // Check all alternatives for best match
                            let bestMatch = { text: transcript, confidence: confidence };
                            for (let j = 0; j < result.length; j++) {
                                if (result[j].confidence > bestMatch.confidence) {
                                    bestMatch = { text: result[j].transcript, confidence: result[j].confidence };
                                }
                            }
                            finalTranscript = bestMatch.text;
                            bestConfidence = bestMatch.confidence;
                            lastConfidence = bestConfidence;
                        } else {
                            interimTranscript += transcript;
                            bestConfidence = Math.max(bestConfidence, confidence);
                        }
                    }

                    // Update confidence indicator
                    updateConfidenceIndicator(bestConfidence);

                    // Display current recognition
                    if (finalTranscript) {
                        queryDisplay.innerHTML = `<span class="recognized-text">${finalTranscript}</span>
                            <span class="confidence-badge">${Math.round(bestConfidence * 100)}%</span>`;

                        // Only process if confidence is above threshold
                        if (bestConfidence >= CONFIDENCE_THRESHOLD) {
                            processCommand(finalTranscript, bestConfidence);
                        } else {
                            // Ask for clarification if low confidence
                            showResponse("I'm not sure I heard you correctly. Could you please repeat that?");
                            speak("I'm not sure I heard you correctly. Could you please repeat that?");
                        }
                    } else if (interimTranscript) {
                        queryDisplay.innerHTML = `<span class="interim-text">${interimTranscript}</span>
                            <span class="confidence-badge interim">${Math.round(bestConfidence * 100)}%</span>`;
                    }
                };

                recognition.onend = () => {
                    isListening = false;
                    orb.classList.remove('listening');
                    statusText.textContent = 'Ready';
                    updateConfidenceIndicator(0);
                    queryDisplay.innerHTML = 'Say <span class="wake-word">"Hey Aura"</span> or click orb';
                    // Restart wake word listening after command is done
                    setTimeout(startWakeWordListening, 500);
                };

                recognition.onerror = (e) => {
                    isListening = false;
                    orb.classList.remove('listening');

                    // Enhanced error handling
                    handleRecognitionError(e.error);

                    // Restart wake word listening on error
                    if (recognitionRetryCount < MAX_RETRY_COUNT) {
                        setTimeout(startWakeWordListening, 1000);
                    }
                };

                recognition.onnomatch = () => {
                    showResponse("I couldn't understand that. Please try speaking more clearly.");
                    speak("I couldn't understand that. Please try speaking more clearly.");
                };

                recognition.onsoundstart = () => {
                    statusText.textContent = 'Hearing you...';
                    orb.classList.add('sound-detected');
                };

                recognition.onsoundend = () => {
                    orb.classList.remove('sound-detected');
                };

                recognition.onspeechstart = () => {
                    statusText.textContent = 'Processing speech...';
                    orb.classList.add('speech-active');
                };

                recognition.onspeechend = () => {
                    statusText.textContent = 'Analyzing...';
                    orb.classList.remove('speech-active');
                };

                // Wake word recognition (continuous background listening)
                wakeWordRecognition = new SR();
                wakeWordRecognition.continuous = true;
                wakeWordRecognition.interimResults = true;
                wakeWordRecognition.lang = 'en-US';
                wakeWordRecognition.maxAlternatives = 3;

                wakeWordRecognition.onresult = (e) => {
                    for (let i = e.resultIndex; i < e.results.length; i++) {
                        const result = e.results[i];

                        // Check all alternatives for wake word
                        for (let j = 0; j < result.length; j++) {
                            const transcript = result[j].transcript.toLowerCase().trim();
                            const confidence = result[j].confidence || 0.7;

                            // Fuzzy matching for wake word
                            if (isWakeWord(transcript) && confidence >= 0.4) {
                                console.log('Wake word detected:', transcript, 'Confidence:', confidence);
                                wakeWordRecognition.stop();
                                isWakeWordListening = false;

                                // Visual feedback
                                showWakeWordActivated();

                                // Start listening for command after a short delay
                                setTimeout(() => {
                                    toggleListening();
                                }, 400);
                                return;
                            }
                        }
                    }
                };

                wakeWordRecognition.onend = () => {
                    isWakeWordListening = false;
                    // Restart wake word listening if not in command mode
                    if (!isListening && recognitionRetryCount < MAX_RETRY_COUNT) {
                        setTimeout(startWakeWordListening, 800);
                    }
                };

                wakeWordRecognition.onerror = (e) => {
                    isWakeWordListening = false;
                    if (e.error !== 'no-speech' && e.error !== 'aborted') {
                        console.log('Wake word error:', e.error);
                        recognitionRetryCount++;
                    }
                    // Restart on error with exponential backoff
                    if (!isListening && recognitionRetryCount < MAX_RETRY_COUNT) {
                        const delay = Math.min(1000 * Math.pow(1.5, recognitionRetryCount), 10000);
                        setTimeout(startWakeWordListening, delay);
                    }
                };

                // Start wake word listening
                setTimeout(startWakeWordListening, 1000);

                // Update status with styled text
                queryDisplay.innerHTML = 'Say <span class="wake-word">"Hey Aura"</span> or click orb';

                // Add styles for recognition feedback
                addRecognitionStyles();
            } else {
                statusText.textContent = 'Speech not supported';
                queryDisplay.textContent = 'Please use Chrome or Edge for voice features';
                addChat('ai', '‚ö†Ô∏è Speech recognition is not supported in this browser. Please use Chrome or Edge for the best experience.');
            }
        }

        // Fuzzy matching for wake word detection
        function isWakeWord(text) {
            // Direct phrase match
            if (WAKE_PHRASES.some(phrase => text.includes(phrase))) {
                return true;
            }

            // Levenshtein distance based fuzzy matching
            const words = text.split(' ');
            for (const word of words) {
                for (const phrase of WAKE_PHRASES) {
                    const phraseWords = phrase.split(' ');
                    for (const phraseWord of phraseWords) {
                        if (levenshteinDistance(word, phraseWord) <= 2) {
                            // Check if "hey" or similar is also present
                            if (phraseWord === 'aura' || phraseWord === 'ara' || phraseWord === 'ora') {
                                const hasHey = words.some(w =>
                                    levenshteinDistance(w, 'hey') <= 1 ||
                                    levenshteinDistance(w, 'hi') <= 1 ||
                                    levenshteinDistance(w, 'hello') <= 2 ||
                                    levenshteinDistance(w, 'ok') <= 1 ||
                                    levenshteinDistance(w, 'yo') <= 1
                                );
                                if (hasHey) return true;
                            }
                        }
                    }
                }
            }

            // Check for just "aura" alone with high confidence
            if (words.includes('aura') || words.some(w => levenshteinDistance(w, 'aura') <= 1)) {
                return true;
            }

            return false;
        }

        // Levenshtein distance for fuzzy matching
        function levenshteinDistance(a, b) {
            if (a.length === 0) return b.length;
            if (b.length === 0) return a.length;

            const matrix = [];
            for (let i = 0; i <= b.length; i++) {
                matrix[i] = [i];
            }
            for (let j = 0; j <= a.length; j++) {
                matrix[0][j] = j;
            }

            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) === a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            return matrix[b.length][a.length];
        }

        function handleRecognitionError(error) {
            let message = '';
            switch (error) {
                case 'no-speech':
                    message = 'No speech detected. Please try again.';
                    statusText.textContent = 'No speech heard';
                    break;
                case 'audio-capture':
                    message = 'No microphone detected. Please check your microphone.';
                    statusText.textContent = 'Mic error';
                    playErrorSound();
                    break;
                case 'not-allowed':
                    message = 'Microphone permission denied. Please allow microphone access.';
                    statusText.textContent = 'Permission denied';
                    playErrorSound();
                    break;
                case 'network':
                    message = 'Network error. Please check your internet connection.';
                    statusText.textContent = 'Network error';
                    recognitionRetryCount++;
                    break;
                case 'aborted':
                    // User aborted, no message needed
                    statusText.textContent = 'Ready';
                    break;
                default:
                    message = 'Recognition error occurred. Retrying...';
                    statusText.textContent = 'Error - Retrying';
                    recognitionRetryCount++;
            }

            if (message && error !== 'no-speech' && error !== 'aborted') {
                console.log('Speech recognition error:', error);
                showResponse(message);
            }
        }

        function updateConfidenceIndicator(confidence) {
            const orbWrapper = document.querySelector('.orb-wrapper');
            if (!orbWrapper) return;

            // Remove existing indicator
            let indicator = document.getElementById('confidenceRing');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'confidenceRing';
                indicator.className = 'confidence-ring';
                orbWrapper.appendChild(indicator);
            }

            // Update indicator based on confidence
            if (confidence > 0) {
                indicator.style.opacity = '1';
                indicator.style.background = `conic-gradient(
                    from 0deg,
                    ${confidence >= 0.8 ? 'var(--emerald)' : confidence >= 0.5 ? 'var(--gold)' : 'var(--coral)'} 0deg,
                    ${confidence >= 0.8 ? 'var(--emerald)' : confidence >= 0.5 ? 'var(--gold)' : 'var(--coral)'} ${confidence * 360}deg,
                    transparent ${confidence * 360}deg
                )`;
            } else {
                indicator.style.opacity = '0';
            }
        }

        function addRecognitionStyles() {
            const style = document.createElement('style');
            style.textContent = `
                .wake-word {
                    color: var(--gold);
                    font-weight: 600;
                }
                
                .recognized-text {
                    color: var(--text);
                }
                
                .interim-text {
                    color: var(--text-dim);
                    font-style: italic;
                }
                
                .confidence-badge {
                    display: inline-block;
                    margin-left: 10px;
                    padding: 2px 8px;
                    background: linear-gradient(135deg, var(--gold), var(--rose-gold));
                    color: #000;
                    border-radius: 10px;
                    font-size: 10px;
                    font-weight: 600;
                }
                
                .confidence-badge.interim {
                    background: rgba(255, 255, 255, 0.2);
                    color: var(--text-dim);
                }
                
                .confidence-ring {
                    position: absolute;
                    inset: -8px;
                    border-radius: 50%;
                    opacity: 0;
                    transition: all 0.3s ease;
                    pointer-events: none;
                    z-index: -1;
                    mask: radial-gradient(transparent 120px, black 121px);
                    -webkit-mask: radial-gradient(transparent 120px, black 121px);
                }
                
                .orb.sound-detected {
                    box-shadow: 
                        0 0 100px rgba(16, 185, 129, 0.4),
                        0 0 150px rgba(212, 175, 55, 0.3),
                        inset 0 0 60px rgba(16, 185, 129, 0.2);
                }
                
                .orb.speech-active {
                    animation: speechPulse 0.5s ease-in-out infinite;
                }
                
                @keyframes speechPulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.03); }
                }
                
                .mic-indicator {
                    position: fixed;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    padding: 8px 16px;
                    background: rgba(0, 0, 0, 0.8);
                    border: 1px solid var(--gold);
                    border-radius: 20px;
                    font-size: 12px;
                    color: var(--gold);
                    display: none;
                    z-index: 1000;
                }
                
                .mic-indicator.active {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }
                
                .mic-indicator::before {
                    content: 'üé§';
                    animation: micPulse 1s ease-in-out infinite;
                }
                
                @keyframes micPulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.5; }
                }
            `;
            document.head.appendChild(style);
        }

        function startWakeWordListening() {
            if (isWakeWordListening || isListening) return;
            if (recognitionRetryCount >= MAX_RETRY_COUNT) {
                console.log('Max retry count reached. Wake word listening disabled.');
                statusText.textContent = 'Tap orb to speak';
                return;
            }

            try {
                wakeWordRecognition.start();
                isWakeWordListening = true;
                recognitionRetryCount = 0; // Reset on successful start
                console.log('Wake word listening started');
            } catch (e) {
                console.log('Wake word start error:', e);
                recognitionRetryCount++;
                const delay = Math.min(1000 * Math.pow(1.5, recognitionRetryCount), 10000);
                setTimeout(startWakeWordListening, delay);
            }
        }

        function stopWakeWordListening() {
            if (wakeWordRecognition && isWakeWordListening) {
                try {
                    wakeWordRecognition.stop();
                } catch (e) {
                    console.log('Stop wake word error:', e);
                }
                isWakeWordListening = false;
            }
        }

        function showWakeWordActivated() {
            // Play activation sound effect
            playActivationSound();

            // Visual pulse effect
            orb.style.boxShadow = '0 0 150px rgba(212, 175, 55, 0.8), 0 0 200px rgba(183, 110, 121, 0.6)';
            orb.classList.add('activated');
            statusText.textContent = 'Yes?';

            const response = "I'm listening...";
            showResponse(response);
            speak(response);

            setTimeout(() => {
                orb.style.boxShadow = '';
                orb.classList.remove('activated');
            }, 600);
        }

        function playActivationSound() {
            try {
                const ctx = getAudioContext();

                // Create a pleasant multi-tone activation chime
                const notes = [880, 1108, 1318]; // A5, C#6, E6 (A major chord)

                notes.forEach((freq, i) => {
                    const oscillator = ctx.createOscillator();
                    const gainNode = ctx.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(ctx.destination);

                    oscillator.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.05);
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0, ctx.currentTime + i * 0.05);
                    gainNode.gain.linearRampToValueAtTime(0.15, ctx.currentTime + i * 0.05 + 0.05);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);

                    oscillator.start(ctx.currentTime + i * 0.05);
                    oscillator.stop(ctx.currentTime + 0.5);
                });
            } catch (e) {
                console.log('Audio not supported:', e);
            }
        }

        function playListeningSound() {
            try {
                const ctx = getAudioContext();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);

                oscillator.frequency.setValueAtTime(660, ctx.currentTime);
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);

                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.15);
            } catch (e) {
                // Audio not supported
            }
        }

        function playErrorSound() {
            try {
                const ctx = getAudioContext();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);

                oscillator.frequency.setValueAtTime(200, ctx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(150, ctx.currentTime + 0.2);
                oscillator.type = 'sawtooth';

                gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);

                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.3);
            } catch (e) {
                // Audio not supported
            }
        }

        function playSuccessSound() {
            try {
                const ctx = getAudioContext();
                const notes = [523, 659]; // C5, E5

                notes.forEach((freq, i) => {
                    const oscillator = ctx.createOscillator();
                    const gainNode = ctx.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(ctx.destination);

                    oscillator.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.1);
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0.1, ctx.currentTime + i * 0.1);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);

                    oscillator.start(ctx.currentTime + i * 0.1);
                    oscillator.stop(ctx.currentTime + 0.4);
                });
            } catch (e) {
                // Audio not supported
            }
        }

        function toggleListening() {
            if (!recognition) return addChat('ai', '‚ö†Ô∏è Speech not supported. Please use Chrome or Edge.');

            // Stop wake word listening when starting command listening
            stopWakeWordListening();

            if (isListening) {
                recognition.stop();
            } else {
                isListening = true;
                try {
                    recognition.start();
                } catch (e) {
                    console.log('Recognition start error:', e);
                    isListening = false;
                    setTimeout(() => toggleListening(), 500);
                }
            }
        }

        function processCommand(text, confidence = 1) {
            // Add to command history
            commandHistory.unshift({ text, confidence, timestamp: Date.now() });
            if (commandHistory.length > 20) commandHistory.pop();

            addChat('user', text);

            // Get response with fuzzy matching
            const { response, action } = getEnhancedResponse(text.toLowerCase(), confidence);

            addChat('ai', response);
            showResponse(response);
            speak(response);

            // Execute action if any
            if (action) action();

            // Play success sound for high confidence
            if (confidence >= 0.8) {
                playSuccessSound();
            }

            queryDisplay.innerHTML = 'Say <span class="wake-word">"Hey Aura"</span> or click orb';
        }

        function animateOrb(iconClass, duration, callback) {
            const orb = document.getElementById('orb');
            const icon = document.getElementById('orbIcon');
            const container = document.querySelector('.orb-container'); // Orbital rings

            // Hide orbital rings during animation
            if (container) container.style.opacity = '0';

            // Set icon class
            // Reset classes
            icon.className = 'orb-icon';

            // Check type and add specific classes
            if (iconClass.includes('fa-dice')) {
                icon.classList.add('fas', iconClass, 'animate-dice');
            } else {
                icon.classList.add('fab', iconClass, 'animate-logo');
                if (iconClass.includes('fa-google') || iconClass.includes('fa-wikipedia')) {
                    icon.classList.remove('fab');
                    icon.classList.add('fab'); // Google is fab, wiki is fab
                }
            }

            // Special case for solid icons if needed
            if (!iconClass.startsWith('fa-')) icon.classList.add(iconClass);

            orb.classList.add('animating');

            // Wait for animation then callback
            setTimeout(() => {
                if (callback) callback();

                // Reset after a delay to show the "opened" state briefly or reset immediately?
                // Resetting immediately might look abrupt if the window opens.
                // But the user might come back.

                setTimeout(() => {
                    orb.classList.remove('animating');
                    icon.className = 'orb-icon'; // Hide
                    if (container) container.style.opacity = '1';
                }, 1000);

            }, duration);
        }

        let visualizerContext = null;
        let visualizerAnalyser = null;
        let visualizerSource = null;
        let visualizerAnimationId = null;

        function startVisualizer() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                return speak("Audio visualization is not supported on this browser.");
            }

            if (!visualizerContext) {
                visualizerContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            if (visualizerContext.state === 'suspended') {
                visualizerContext.resume();
            }

            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    visualizerAnalyser = visualizerContext.createAnalyser();
                    visualizerSource = visualizerContext.createMediaStreamSource(stream);
                    visualizerSource.connect(visualizerAnalyser);

                    visualizerAnalyser.fftSize = 64; // Low FFT size for punchy bass
                    const bufferLength = visualizerAnalyser.frequencyBinCount;
                    const dataArray = new Uint8Array(bufferLength);

                    const orb = document.getElementById('orb');
                    orb.classList.add('visualizing');
                    statusText.textContent = "Listening to Music...";

                    function animate() {
                        visualizerAnimationId = requestAnimationFrame(animate);
                        visualizerAnalyser.getByteFrequencyData(dataArray);

                        // Calculate bass (lower frequencies)
                        let bassTotal = 0;
                        const bassBins = 8;
                        for (let i = 0; i < bassBins; i++) bassTotal += dataArray[i];
                        const bassAvg = bassTotal / bassBins;

                        // Calculate mid/highs
                        let midTotal = 0;
                        for (let i = bassBins; i < bufferLength; i++) midTotal += dataArray[i];
                        const midAvg = midTotal / (bufferLength - bassBins);

                        // Dynamic scaling
                        const scale = 1 + (bassAvg / 255) * 0.4;

                        // Dynamic glow
                        const glowSize = 100 + (bassAvg / 2);
                        const glowColor = midAvg > 100 ? '255, 107, 107' : '212, 175, 55'; // Red tint on highs

                        orb.style.transform = `scale(${scale})`;
                        orb.style.boxShadow = `0 0 ${glowSize}px rgba(${glowColor}, 0.6), inset 0 0 60px rgba(255,255,255,0.1)`;

                        // Rotate based on energy
                        // orb.style.transform += ` rotate(${Date.now() / 10}deg)`; // Too chaotic
                    }

                    animate();
                    speak("Visualizer started. Play some music!");
                })
                .catch(err => {
                    console.error('Visualizer error:', err);
                    speak("I need microphone access to visualize music.");
                });
        }

        function stopVisualizer() {
            if (visualizerAnimationId) {
                cancelAnimationFrame(visualizerAnimationId);
                visualizerAnimationId = null;
            }

            const orb = document.getElementById('orb');
            orb.classList.remove('visualizing');
            orb.style.transform = '';
            orb.style.boxShadow = '';
            statusText.textContent = "Ready";
            speak("Visualizer stopped.");
        }

        // ========================================
        // NOTES & THEMES
        // ========================================

        function initNotes() {
            renderNotes();
            // Restore Theme
            const savedTheme = localStorage.getItem('aura_theme');
            if (savedTheme) document.body.className = `theme-${savedTheme}`;
        }

        function getNotes() {
            return JSON.parse(localStorage.getItem('aura_notes') || '[]');
        }

        function addNote(text) {
            const notes = getNotes();
            notes.push({ id: Date.now(), text });
            localStorage.setItem('aura_notes', JSON.stringify(notes));
            renderNotes();
            speak('Note added.');
        }

        function deleteNote(id) {
            const notes = getNotes().filter(n => n.id !== id);
            localStorage.setItem('aura_notes', JSON.stringify(notes));
            renderNotes();
        }

        function renderNotes() {
            const list = document.getElementById('notesList');
            const notes = getNotes();
            if (notes.length === 0) {
                list.innerHTML = '<div class="empty-notes">No notes yet.</div>';
                return;
            }
            list.innerHTML = notes.map(n => `
                <div class="note-item">
                    <span>${n.text}</span>
                    <span class="delete-note" onclick="deleteNote(${n.id})">√ó</span>
                </div>
            `).join('');
        }

        function setTheme(theme) {
            document.body.className = theme === 'default' ? '' : `theme-${theme}`;
            localStorage.setItem('aura_theme', theme);
            const themeNames = { cyberpunk: 'Cyberpunk', ocean: 'Ocean Blue', matrix: 'The Matrix', crimson: 'Crimson Red', midnight: 'Midnight Purple' };
            speak(`Theme changed to ${themeNames[theme] || 'Default'}.`);
        }

        // Enhanced response system with fuzzy matching
        function getEnhancedResponse(cmd, confidence) {
            // Command patterns with fuzzy matching support
            const commands = [
                // === SYSTEM & STATUS ===
                {
                    patterns: ['start visualizer', 'visualizer', 'visualise music', 'dance mode', 'party mode'],
                    response: () => "Starting music visualizer...",
                    action: () => startVisualizer()
                },
                {
                    patterns: ['stop visualizer', 'end visualizer', 'stop dancing'],
                    response: () => "Stopping visualizer.",
                    action: () => stopVisualizer()
                },
                // === NOTES ===
                {
                    patterns: ['take a note', 'add note', 'write down', 'remind me to', 'note'],
                    response: () => "I've saved that note for you.",
                    action: () => {
                        const text = cmd.replace(/take a note|add note|write down|remind me to|note|that/gi, '').trim();
                        if (text) {
                            addNote(text);
                            return "Note saved.";
                        }
                        else return "What should I write?";
                    }
                },
                {
                    patterns: ['delete note', 'remove note', 'clear notes'],
                    response: () => "To delete a note, click the X icon next to it.",
                    action: () => {
                        if (cmd.includes('all')) {
                            localStorage.setItem('aura_notes', '[]');
                            renderNotes();
                            speak("All notes cleared.");
                        }
                    }
                },
                // === THEMES ===
                {
                    patterns: ['change theme', 'set theme', 'change color', 'color mode'],
                    response: () => "Changing theme...",
                    action: () => {
                        if (cmd.includes('cyberpunk')) setTheme('cyberpunk');
                        else if (cmd.includes('ocean') || cmd.includes('blue')) setTheme('ocean');
                        else if (cmd.includes('matrix') || cmd.includes('green')) setTheme('matrix');
                        else if (cmd.includes('crimson') || cmd.includes('red')) setTheme('crimson');
                        else if (cmd.includes('midnight') || cmd.includes('purple')) setTheme('midnight');
                        else setTheme('default');
                    }
                },
                {
                    patterns: ['time', 'what time', 'current time', 'tell me the time', 'clock'],
                    response: () => `The current time is ${new Date().toLocaleTimeString()}.`
                },
                {
                    patterns: ['date', 'what date', 'today', 'what day', 'which day', 'calendar'],
                    response: () => `Today is ${new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}.`
                },
                {
                    patterns: ['weather', 'temperature', 'how hot', 'how cold', 'climate', 'forecast'],
                    response: () => `The current temperature is ${document.getElementById('weatherTemp').textContent}¬∞C with ${document.getElementById('weatherDesc').textContent.toLowerCase()} conditions. Humidity is at ${document.getElementById('weatherHumidity').textContent}.`
                },
                {
                    patterns: ['battery', 'power', 'charge', 'battery level', 'energy'],
                    response: () => `Your battery is at ${document.getElementById('batteryPercent').textContent}%. ${document.getElementById('batteryStatus').textContent.includes('Charging') ? 'Currently charging.' : ''}`
                },
                {
                    patterns: ['cpu', 'processor', 'cpu usage', 'performance'],
                    response: () => `Current CPU usage is at ${document.getElementById('cpuPercent').textContent}%.`
                },
                {
                    patterns: ['memory', 'ram', 'memory usage', 'storage'],
                    response: () => `Memory usage is at ${document.getElementById('memPercent').textContent}. You're using ${document.getElementById('memUsed').textContent} out of ${document.getElementById('memTotal').textContent}.`
                },
                {
                    patterns: ['network', 'internet', 'connection', 'wifi', 'speed'],
                    response: () => `You're connected via ${document.getElementById('networkType').textContent} with an estimated speed of ${document.getElementById('networkSpeed').textContent}.`
                },

                // === UTILITIES ===
                {
                    patterns: ['calculate', 'solve', 'math', 'plus', 'minus', 'times', 'divide', 'multiply'],
                    response: () => {
                        try {
                            // Extract numbers and operators
                            const expression = cmd.replace(/[^0-9+\-*/().]/g, '');
                            if (!expression) return "Please provide a math problem, for example: 'calculate 5 plus 3'.";
                            // Safe evaluation for basic math
                            const result = Function('"use strict";return (' + expression + ')')();
                            return `The answer is ${result}.`;
                        } catch {
                            return "I couldn't calculate that. Please say something like 'calculate 10 times 5'.";
                        }
                    }
                },
                {
                    patterns: ['timer', 'set timer', 'countdown', 'alarm'],
                    response: () => {
                        const match = cmd.match(/(\d+)\s*(second|minute|hour)/i);
                        if (match) {
                            const amount = parseInt(match[1]);
                            const unit = match[2].toLowerCase();
                            let ms = amount * 1000;
                            if (unit.startsWith('minute')) ms *= 60;
                            if (unit.startsWith('hour')) ms *= 3600;

                            setTimeout(() => {
                                playActivationSound();
                                speak(`Time is up! Your ${amount} ${unit} timer has finished.`);
                                showResponse(`‚è∞ Timer finished! (${amount} ${unit})`);
                            }, ms);

                            return `Setting a timer for ${amount} ${unit}s.`;
                        }
                        return "Please specify the duration, for example: 'set timer for 10 seconds'.";
                    }
                },
                {
                    patterns: ['flip coin', 'toss coin', 'heads or tails', 'flip a coin'],
                    response: () => "Flipping a coin...",
                    action: () => animateOrb('fa-coins', 2000, () => {
                        const result = Math.random() < 0.5 ? "Heads" : "Tails";
                        const text = `It landed on ${result}!`;
                        speak(text);
                        showResponse(text);
                    })
                },
                {
                    patterns: ['roll dice', 'roll a die', 'dice roll', 'random number'],
                    response: () => "Rolling the dice...",
                    action: () => animateOrb('fa-dice', 2000, () => {
                        const result = Math.floor(Math.random() * 6) + 1;
                        const text = `You rolled a ${result}.`;
                        speak(text);
                        showResponse(text);
                    })
                },

                // === CONVERSATION ===
                {
                    patterns: ['hello', 'hi', 'hey', 'greetings', 'good morning', 'good afternoon', 'good evening', 'yo'],
                    response: () => {
                        const hour = new Date().getHours();
                        const greeting = hour < 12 ? 'Good morning' : hour < 17 ? 'Good afternoon' : 'Good evening';
                        return `${greeting}! It's wonderful to connect with you. How may I assist you today?`;
                    }
                },
                {
                    patterns: ['how are you', 'how do you feel', 'status report', 'system status'],
                    response: () => "I'm functioning optimally, thank you! All systems are green and I'm ready to help."
                },
                {
                    patterns: ['joke', 'funny', 'make me laugh', 'tell me a joke'],
                    response: () => {
                        const jokes = [
                            'Why do programmers prefer dark mode? Because light attracts bugs! üòÑ',
                            'Why did the AI go to therapy? It had too many deep issues! ü§ñ',
                            'What do you call a computer that sings? A-Dell! üé§',
                            'Why was the JavaScript developer sad? Because he didn\'t Node how to Express himself! üíª',
                            'I told my computer I needed a break. Now it won\'t stop sending me Kit-Kat ads. üç´',
                            'What is a computer\'s favorite snack? Microchips! üç™'
                        ];
                        return jokes[Math.floor(Math.random() * jokes.length)];
                    }
                },
                {
                    patterns: ['thank', 'thanks', 'appreciate', 'good job'],
                    response: () => "You're most welcome! It's my pleasure to serve you."
                },
                {
                    patterns: ['who are you', 'what are you', 'your name', 'identify yourself'],
                    response: () => "I'm AURA, your Advanced User Responsive AI assistant. I'm here to help you with tasks, information, and system monitoring."
                },
                {
                    patterns: ['what can you do', 'help', 'commands', 'features', 'guide'],
                    response: () => "I can check time/weather, monitor system stats, open websites, calculate math, set timers, flip coins, tell jokes, and more! Just ask."
                },
                {
                    patterns: ['goodbye', 'bye', 'see you', 'exit', 'quit', 'shutdown'],
                    response: () => {
                        const hour = new Date().getHours();
                        return hour >= 20 || hour < 6 ? 'Good night! Sweet dreams.' : 'Goodbye! Have a productive day.';
                    }
                },

                // === APPS & WEBSITES ===
                {
                    patterns: ['open youtube', 'youtube', 'watch video'],
                    response: () => 'Opening YouTube...',
                    action: () => animateOrb('fa-youtube', 1500, () => window.open('https://youtube.com', '_blank'))
                },
                {
                    patterns: ['open google', 'google', 'search engine'],
                    response: () => 'Opening Google Search...',
                    action: () => animateOrb('fa-google', 1500, () => window.open('https://google.com', '_blank'))
                },
                {
                    patterns: ['open gmail', 'gmail', 'check email', 'mail', 'inbox'],
                    response: () => 'Opening Gmail...',
                    action: () => animateOrb('fa-envelope', 1500, () => window.open('https://mail.google.com', '_blank'))
                },
                {
                    patterns: ['open maps', 'maps', 'google maps', 'navigation', 'location'],
                    response: () => 'Opening Google Maps...',
                    action: () => animateOrb('fa-map', 1500, () => window.open('https://maps.google.com', '_blank'))
                },
                {
                    patterns: ['open spotify', 'spotify', 'play music', 'music'],
                    response: () => 'Opening Spotify...',
                    action: () => animateOrb('fa-spotify', 1500, () => window.open('https://open.spotify.com', '_blank'))
                },
                {
                    patterns: ['open netflix', 'netflix', 'movies'],
                    response: () => 'Opening Netflix...',
                    action: () => animateOrb('fa-film', 1500, () => window.open('https://netflix.com', '_blank'))
                },
                {
                    patterns: ['open github', 'github', 'code', 'repository'],
                    response: () => 'Opening GitHub...',
                    action: () => animateOrb('fa-github', 1500, () => window.open('https://github.com', '_blank'))
                },
                {
                    patterns: ['open whatsapp', 'whatsapp', 'chat'],
                    response: () => 'Opening WhatsApp Web...',
                    action: () => animateOrb('fa-whatsapp', 1500, () => window.open('https://web.whatsapp.com', '_blank'))
                },
                {
                    patterns: ['open instagram', 'instagram', 'insta'],
                    response: () => 'Opening Instagram...',
                    action: () => animateOrb('fa-instagram', 1500, () => window.open('https://instagram.com', '_blank'))
                },
                {
                    patterns: ['open twitter', 'twitter', 'x.com', 'open x'],
                    response: () => 'Opening X (Twitter)...',
                    action: () => animateOrb('fa-twitter', 1500, () => window.open('https://x.com', '_blank'))
                },
                {
                    patterns: ['open linkedin', 'linkedin', 'jobs'],
                    response: () => 'Opening LinkedIn...',
                    action: () => animateOrb('fa-linkedin', 1500, () => window.open('https://linkedin.com', '_blank'))
                },
                {
                    patterns: ['news', 'latest news', 'headlines', 'read news'],
                    response: () => 'Opening Google News...',
                    action: () => animateOrb('fa-newspaper', 1500, () => window.open('https://news.google.com', '_blank'))
                },
                {
                    patterns: ['wikipedia', 'wiki', 'encyclopedia'],
                    response: () => 'Opening Wikipedia...',
                    action: () => animateOrb('fa-wikipedia-w', 1500, () => window.open('https://wikipedia.org', '_blank'))
                }
            ];

            // Check for search command
            if (cmd.includes('search') || cmd.includes('look up') || cmd.includes('find')) {
                const searchTerms = cmd.replace(/search|look up|find|for|about/gi, '').trim();
                if (searchTerms) {
                    return {
                        response: `Searching for "${searchTerms}".`,
                        action: () => window.open('https://google.com/search?q=' + encodeURIComponent(searchTerms), '_blank')
                    };
                }
            }

            // Find best matching command using fuzzy matching
            let bestMatch = null;
            let bestScore = 0;

            for (const command of commands) {
                for (const pattern of command.patterns) {
                    const score = fuzzyMatch(cmd, pattern);
                    if (score > bestScore && score > 0.4) {
                        bestScore = score;
                        bestMatch = command;
                    }
                }
            }

            if (bestMatch) {
                return {
                    response: bestMatch.response(),
                    action: bestMatch.action || null
                };
            }

            // Default response with context
            return {
                response: confidence < 0.6
                    ? `I'm not quite sure I understood "${cmd}". Could you please rephrase that?`
                    : `I heard "${cmd}". I'm still learning new commands. How else may I assist you?`,
                action: null
            };
        }

        // Fuzzy matching function
        function fuzzyMatch(input, pattern) {
            input = input.toLowerCase();
            pattern = pattern.toLowerCase();

            // Direct inclusion check
            if (input.includes(pattern) || pattern.includes(input)) {
                return 1;
            }

            // Word-by-word matching
            const inputWords = input.split(/\s+/);
            const patternWords = pattern.split(/\s+/);

            let matches = 0;
            for (const pw of patternWords) {
                for (const iw of inputWords) {
                    if (iw === pw || levenshteinDistance(iw, pw) <= Math.max(1, pw.length / 4)) {
                        matches++;
                        break;
                    }
                }
            }

            return matches / patternWords.length;
        }

        function speak(text) {
            synthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.95;
            utterance.pitch = 1;
            utterance.volume = 0.9;

            // Try to find a good voice
            const voices = synthesis.getVoices();
            const preferredVoices = ['Google UK English Female', 'Microsoft Zira', 'Samantha', 'Karen'];

            for (const preferred of preferredVoices) {
                const voice = voices.find(v => v.name.includes(preferred));
                if (voice) {
                    utterance.voice = voice;
                    break;
                }
            }

            // Fallback to first English voice
            if (!utterance.voice) {
                const englishVoice = voices.find(v => v.lang.startsWith('en'));
                if (englishVoice) utterance.voice = englishVoice;
            }

            synthesis.speak(utterance);
        }

        // Load voices when available
        if (synthesis.onvoiceschanged !== undefined) {
            synthesis.onvoiceschanged = () => {
                // Voices loaded, speak function will use them
            };
        }

        // ========================================
        // AI RESPONSE DISPLAY (Under Orb)
        // ========================================
        function showResponse(text) {
            clearTimeout(responseTimeout);
            aiResponseText.textContent = text;
            aiResponseContainer.classList.add('visible');

            // Auto-hide after 10 seconds
            responseTimeout = setTimeout(() => {
                hideResponse();
            }, 10000);
        }

        function hideResponse() {
            aiResponseContainer.classList.remove('visible');
        }

        // ========================================
        // CHAT
        // ========================================
        function addChat(type, text) {
            const el = document.createElement('div');
            el.className = 'chat-msg ' + type;
            el.textContent = text;
            document.getElementById('chatMessages').appendChild(el);
            document.getElementById('chatMessages').scrollTop = 99999;
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (text) {
                input.value = '';
                addChat('user', text);
                const response = getResponse(text.toLowerCase());
                setTimeout(() => {
                    addChat('ai', response);
                    showResponse(response);
                }, 500);
            }
        }

        function handleKey(e) {
            if (e.key === 'Enter') sendMessage();
        }

        // ========================================
        // QUICK ACTIONS
        // ========================================
        function openApp(app) {
            const urls = {
                youtube: 'https://youtube.com',
                google: 'https://google.com',
                gmail: 'https://mail.google.com',
                maps: 'https://maps.google.com'
            };
            window.open(urls[app], '_blank');
            const response = `Opening ${app.charAt(0).toUpperCase() + app.slice(1)}...`;
            addChat('ai', response);
            showResponse(response);
        }

        init();
    </script>
</body>

</html>